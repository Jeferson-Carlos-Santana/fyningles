{% load static %}
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="{% static 'chat/css/style.css' %}">
    <meta charset="utf-8">
    <title>chat</title>
</head>
<body>

        <div class="layout">
            <nav class="sidebar">
                <div class="sidebar-inner">
                    <div class="bar-1">
                        <ul class="menu">
                            <div class="infor">üë§ Jeferson carlos Santana</div>
                            <div class="infor">‚≠êPontos acumulados: <span class="text-success">1.075.352</span></div>
                            <div class="infor">‚≠êPontos em andamento: <span class="text-info">253</span></div>
                            <div class="infor">‚≠êPontos que faltam: <span class="text-info">768</span></div>
                            <div class="infor">‚≠êPontos feitos: <span class="text-info">422</span></div>
                            <li><a href="/">Dashboard</a></li>                          
                            <li><a href="/dictionary/">Dicion√°rio</a></li>                   
                        </ul>
                    </div>
                    <input type="text" class="lesson-search" placeholder="üîç Buscar li√ß√£o">
                    <div class="bar-2">                        
                        <ul class="menu lessons">                            
                            <li><a href="#">üìã Lesson 1</a></li>
                            <li><a href="#">üìã Lesson 2</a></li>
                            <li><a href="#">üìã Lesson 3</a></li>                 
                        </ul>
                    </div>
                    <div class="logout">
                        <li><a href="/">Sair</a></li>
                    </div>
                </div>
            </nav>

            <main class="content">
                <div class="content-inner">
                    <div class="tittle-cont">
                        <div class="aula">                    
                            <button class="menu-toggle" aria-label="Abrir menu">
                                <img src="{% static 'chat/img/menu.png' %}" alt="Menu">
                            </button> 
                            chat
                        </div>                        
                    </div>

                    





                    <div class="chat-area">
  {% for line in lines %}
    <div class="chat-message {{ line.role }}"
         data-id="{{ line.id }}"
         style="display:none;">
      {{ line.expected_en }}
    </div>
  {% endfor %}
</div>

<button id="btn-start">‚ñ∂Ô∏è Iniciar li√ß√£o</button>
<button id="btn-mic" disabled>üé§ Falar</button>


{% comment %} <audio id="player"></audio> {% endcomment %}










                    
                    <div class="footer-cont">
                        {% comment %} <button class="theme-toggle" aria-label="Trocar tema">üåô </button> {% endcomment %}
                         <i><strong>¬© 2026 - JPM-development - All rights reserved - Engineering & Technology</strong><i>                        
                    </div>
                    
                </div>
            </main>
        </div>
    <script src="{% static 'chat/js/script.js' %}"></script>

    


{% comment %} <script>
document.addEventListener("DOMContentLoaded", function () {

  var btn = document.getElementById("btn-next");
  var msgs = document.querySelectorAll(".chat-message");
  var index = 0;

  // esconde todas
  for (var i = 0; i < msgs.length; i++) {
    msgs[i].style.display = "none";
  }

  btn.onclick = function () {

    // acabou
    if (index >= msgs.length) {
      btn.innerText = "‚úîÔ∏è Fim";
      btn.disabled = true;
      return;
    }

    // pega a frase atual
    var msg = msgs[index];
    var lineId = msg.getAttribute("data-id");

    // mostra a frase
    msg.style.display = "block";

    // chama o TTS
    fetch("/tts/line/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ line_id: lineId })
    })
    .then(function (r) { return r.json(); })
    .then(function (d) {
      if (d.file) {
        var audio = new Audio("/media/cache/" + d.file + "?t=" + Date.now());
        audio.play();
      }
    });

    // AVAN√áA UMA VEZ
    index++;
  };

});
</script> {% endcomment %}

<script>
document.addEventListener("DOMContentLoaded", function () {

  // ===== SPEECH =====
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = "en-US";
  recognition.continuous = false;
  recognition.interimResults = false;

  // ===== ELEMENTOS =====
  const msgs = document.querySelectorAll(".chat-message");
  const btnStart = document.getElementById("btn-start");
  const btnMic = document.getElementById("btn-mic");

  let index = 0;

  // esconde todas
  msgs.forEach(m => m.style.display = "none");
  btnMic.disabled = true;

  // ===== MOSTRA FRASE + GERA AUDIO =====
  function mostrarSistema() {
    if (index >= msgs.length) {
      btnMic.disabled = true;
      btnStart.disabled = true;
      return;
    }

    const msg = msgs[index];
    const lineId = msg.dataset.id;

    msg.style.display = "block";

    // üîä TTS (GERA AUDIO NO SERVER)
    fetch("/tts/line/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ line_id: lineId })
    })
    .then(r => r.json())
    .then(d => {
      if (d.file) {
        new Audio("/media/cache/" + d.file + "?t=" + Date.now()).play();
      }
    });

    btnMic.disabled = false;
  }

  // ===== BOT√ÉO INICIAR =====
  btnStart.onclick = function () {
    btnStart.disabled = true;
    mostrarSistema();
  };

  // ===== BOT√ÉO MICROFONE =====
  btnMic.onclick = function () {
    btnMic.disabled = true;
    recognition.start();
  };

  // ===== RESPOSTA DO USU√ÅRIO =====
  recognition.onresult = function (e) {
    const texto = e.results[0][0].transcript;

    const user = document.createElement("div");
    user.className = "chat-message user";
    user.textContent = texto;

    msgs[index].after(user);

    index++;
    mostrarSistema();
  };

});
</script>








</body>
</html> 
{% comment %} J56#sr78iu#G95 {% endcomment %}
