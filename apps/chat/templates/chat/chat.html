{% load static %}
{% csrf_token %}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">

    <meta charset="utf-8">
    <title>chat</title>
    <link rel="stylesheet" href="{% static 'chat/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'chat/css/chat.css' %}">
    <link rel="stylesheet" href="{% static 'chat/css/btn.css' %}">
    <link rel="stylesheet" href="{% static 'chat/css/others.css' %}">    
</head>
<body data-lesson-id="{{ lesson_id|default:'' }}" data-username="{{ username|escapejs }}">

  <div class="layout">
    <nav class="sidebar">
      <div class="sidebar-inner">
        <div class="sidebar-close">
          ‚úï
        </div>

        <div class="bar-1">          
          <div class="infor" style="padding: 5px;">Ol√°, {{ request.user.username }}!</div>
          <div class="info-lesson">
          <div class="infor">Pontos acumulados: <span class="text-warning-middle" id="total-points">0</span></div>
          <div class="infor">Pontos em andamento: <span class="text-warning-middle" id="points-andamento">0</span></div>
          <div class="infor">Pontos que faltam: <span class="text-warning-middle" id="points-faltam">0</span></div>
          <div class="infor">Pontos feitos: <span class="text-warning-middle" id="points-feitos">0</span></div>
          </div>
          <ul class="menu">  
            {% if request.user.is_superuser %}
              <li><a href="/admin/">Administra√ß√£o</a></li>
            {% endif %}          
            <li><a href="/dashboard/">Dashboard</a></li>  
            {% if request.user.is_superuser %}                        
            <li><a href="/dictionary/">Dicion√°rio</a></li> 
            {% endif %}                  
          </ul>
        </div>
        <input type="text" class="lesson-search" placeholder="üîç Buscar li√ß√£o">
        <div class="bar-2">                        
          <ul class="menu lessons">                            
            <li><a href="/chat/1/">üìã Usando verbos</a></li>
            <li><a href="/chat/2/">üìã Express√µes populares</a></li>
            <li><a href="/chat/3/">üìã Utilidades di√°rias</a></li>                
          </ul>
        </div>
        <div class="logout">
          <ul class="menu"> 
            <li>
              <form method="post" action="/admin/logout/">
                {% csrf_token %}
                <button type="submit">Sair</button>
               </form>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="content">
      <div class="content-inner">

        <div class="tittle-cont">
          <div class="aula">                    
            <button class="menu-toggle" aria-label="Abrir menu">
              <img src="{% static 'chat/img/menu.png' %}" alt="Menu">
            </button> 
            chat : {{ lesson_title }}           
          </div>                                  
        </div>
        <div class="painel-master">
            <button class="play-madeira-velha" id="btn-start" title="Iniciar li√ß√£o." disabled></button>
            <button id="btnAutoSkip" class="auto-off" title="Avan√ßa para pr√≥xima frase quando fecha o microfone.">SKIP: OFF</button>
            <button id="btnAutoMic" class="auto-off" title="Ativar o microfone autom√°ticamente.">MIC: OFF</button> 
            <span id="timer-aula" style="
              margin-left: 12px;
              font-weight: bold;
              color: #ffb300;
            ">
              ‚è±Ô∏è 00:00
            </span>
        </div>

        <div class="chat-area">
          {% for line in lines %}
          <div class="chat-message {{ line.role }} base"
            data-id="{{ line.id }}"
            data-auto="{{ line.auto|yesno:'1,0' }}"
            data-end="{{ line.end|yesno:'1,0' }}"
            data-expected="{{ line.expected_en|default:'' }}"
            style="display:none;">
            {{ line.content_pt|safe }}
          </div>
          {% endfor %}
        </div>
        
        <div class="inline-input">            
            <input type="text" id="mensagem" placeholder="Digite sua resposta em ingl√™s." oncopy="return false" onpaste="return false" oncut="return false" autocomplete="off" />           
            <button id="btnEnviar" class="btn-madeira-velha" onclick="enviarMensagem()">Enviar</button>
            <button class="btn-madeira-velha" id="btn-mic" onclick="toggleMic()">üé§</button>    
        </div>

        <div class="footer-cont">
          {% comment %} <button class="theme-toggle" aria-label="Trocar tema">üåô </button> {% endcomment %}
          <i><strong>¬© 2026 - JPM-development - All rights reserved - Engineering e Technology</strong></i>                        
        </div>
      </div>
    </main>
  </div>

<!-- MODAL NIVEL -->
<div id="nivel-modal" class="nivel-modal" style="display:none;">
  <div class="nivel-box">
    <button class="nivel-close" aria-label="Fechar">√ó</button>
    <h3>Qual n√≠vel voc√™ se encaixa?</h3>
    <label><input type="radio" name="nivel" value="1"> Repeti√ß√£o b√°sica <span class="text-warning-middle">(repete menos vezes a frase)</span>.</label>
    <label><input type="radio" name="nivel" value="2"> Repeti√ß√£o intermedi√°ria.</label>
    <label><input type="radio" name="nivel" value="3"> Repeti√ß√£o intensiva <span class="text-warning-middle">(repete a frase mais vezes)</span>.</label>
    <label>Essas repeti√ß√µes ser√£o distribu√≠das ao longo do tempo, de modo a garantir maior efic√°cia no processo de aprendizagem.</label>
    <label>Essas op√ß√µes est√£o relacionadas √† facilidade individual de aprendizagem. Caso tenha d√∫vida, recomenda-se optar pela op√ß√£o intermedi√°ria. A escolha poder√° ser realizada apenas uma √∫nica vez.</label>
    <label>A pergunta a ser considerada √©: <i class="text-warning-middle">Eu aprendo frases com facilidade?</i></label>
    <button id="btn-salvar-nivel">Confirmar</button>
  </div>
</div>

<script src="{% static 'chat/js/script.js' %}"></script> 
<script src="{% static 'chat/js/chat.js' %}"></script>

</body>
</html> 