{% load static %}
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="{% static 'chat/css/style.css' %}">
    <meta charset="utf-8">
    <title>chat</title>
</head>
<body>

        <div class="layout">
            <nav class="sidebar">
                <div class="sidebar-inner">
                    <div class="bar-1">
                        <ul class="menu">
                            <div class="infor">ğŸ‘¤ Jeferson carlos Santana</div>
                            <div class="infor">â­Pontos acumulados: <span class="text-success">1.075.352</span></div>
                            <div class="infor">â­Pontos em andamento: <span class="text-info">253</span></div>
                            <div class="infor">â­Pontos que faltam: <span class="text-info">768</span></div>
                            <div class="infor">â­Pontos feitos: <span class="text-info">422</span></div>
                            <li><a href="/">Dashboard</a></li>                          
                            <li><a href="/dictionary/">DicionÃ¡rio</a></li>                   
                        </ul>
                    </div>
                    <input type="text" class="lesson-search" placeholder="ğŸ” Buscar liÃ§Ã£o">
                    <div class="bar-2">                        
                        <ul class="menu lessons">                            
                            <li><a href="#">ğŸ“‹ Lesson 1</a></li>
                            <li><a href="#">ğŸ“‹ Lesson 2</a></li>
                            <li><a href="#">ğŸ“‹ Lesson 3</a></li>                 
                        </ul>
                    </div>
                    <div class="logout">
                        <li><a href="/">Sair</a></li>
                    </div>
                </div>
            </nav>

            <main class="content">
                <div class="content-inner">
                    <div class="tittle-cont">
                        <div class="aula">                    
                            <button class="menu-toggle" aria-label="Abrir menu">
                                <img src="{% static 'chat/img/menu.png' %}" alt="Menu">
                            </button> 
                            chat
                        </div>                        
                    </div>

                    





                    <div class="chat-area">
  {% for line in lines %}
    <div class="chat-message {{ line.role }}"
         data-id="{{ line.id }}"
         style="display:none;">
      {{ line.expected_en }}
    </div>
  {% endfor %}
</div>

<button id="btn-next"
        style="
          position: fixed;
          bottom: 20px;
          right: 20px;
          z-index: 9999;
          background: #00c853;
          color: #000;
          padding: 12px 18px;
          border-radius: 8px;
          border: none;
          cursor: pointer;
        ">
  ğŸ”Š Repeti / PrÃ³xima
</button>

<audio id="player"></audio>










                    
                    <div class="footer-cont">
                        {% comment %} <button class="theme-toggle" aria-label="Trocar tema">ğŸŒ™ </button> {% endcomment %}
                         <i><strong>Â© 2026 - JPM-development - All rights reserved - Engineering & Technology</strong><i>                        
                    </div>
                    
                </div>
            </main>
        </div>
    <script src="{% static 'chat/js/script.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {

  const msgs = document.querySelectorAll(".chat-message");
  const btnNext = document.getElementById("btn-next");
  const player = document.getElementById("player");

  let index = 0;

  // mostra a primeira frase
  if (msgs.length > 0) {
    msgs[0].style.display = "block";
  }

  btnNext.addEventListener("click", () => {

    // seguranÃ§a
    if (index >= msgs.length) {
      btnNext.style.display = "none";
      return;
    }

    const msg = msgs[index];
    const lineId = msg.dataset.id;

    // desabilita botÃ£o enquanto gera/toca
    btnNext.disabled = true;
    btnNext.textContent = "ğŸ”Š Gerando Ã¡udio...";

    // pede Ã¡udio ao TTS externo
    fetch("/tts/line/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ line_id: lineId })
    })
    .then(r => r.json())
    .then(data => {
      player.src = "/media/cache/" + data.file;
      player.play();

      player.onended = () => {
        // quando termina o Ã¡udio â†’ libera prÃ³xima frase
        index++;

        if (index < msgs.length) {
          msgs[index].style.display = "block";
          btnNext.disabled = false;
          btnNext.textContent = "ğŸ”Š Repeti / PrÃ³xima";
        } else {
          btnNext.textContent = "âœ”ï¸ Fim da liÃ§Ã£o";
          btnNext.disabled = true;
        }
      };
    })
    .catch(err => {
      console.error("Erro TTS:", err);
      btnNext.disabled = false;
      btnNext.textContent = "ğŸ”Š Repeti / PrÃ³xima";
    });

  });

});
</script>



</body>
</html>
